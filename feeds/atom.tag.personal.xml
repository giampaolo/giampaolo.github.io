<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Giampaolo Rodola - personal</title><link href="https://gmpy.dev/" rel="alternate"></link><link href="https://gmpy.dev/feeds/atom.tag.personal.xml" rel="self"></link><id>https://gmpy.dev/</id><updated>2015-06-13T00:00:00+02:00</updated><subtitle>Python enthusiast, core developer, psutil author</subtitle><entry><title>psutil 3.0, aka how I reimplemented ifconfig in Python</title><link href="https://gmpy.dev/blog/2015/psutil-30-aka-how-i-reimplemented-ifconfig-in-python" rel="alternate"></link><published>2015-06-13T00:00:00+02:00</published><updated>2015-06-13T00:00:00+02:00</updated><author><name>Giampaolo Rodola</name></author><id>tag:gmpy.dev,2015-06-13:/blog/2015/psutil-30-aka-how-i-reimplemented-ifconfig-in-python</id><summary type="html">&lt;p&gt;Here we are. It's been a long time since my last blog post and my last &lt;a class="reference external" href="https://github.com/giampaolo/psutil"&gt;psutil&lt;/a&gt; release. The reason? I've been travelling! I mean... a lot. I've spent 3 months in Berlin, 3 weeks in Japan and 2 months in New York City. While I was there I finally â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Here we are. It's been a long time since my last blog post and my last &lt;a class="reference external" href="https://github.com/giampaolo/psutil"&gt;psutil&lt;/a&gt; release. The reason? I've been travelling! I mean... a lot. I've spent 3 months in Berlin, 3 weeks in Japan and 2 months in New York City. While I was there I finally had the chance to meet my friend &lt;a class="reference external" href="http://jayloden.com/software.htm"&gt;Jay Loden&lt;/a&gt; in person. &lt;a class="reference external" href="https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xta1/t31.0-8/11263024_10153285412879890_759604551146752808_o.jpg"&gt;Jay and I&lt;/a&gt; originally started working on psutil together &lt;a class="reference external" href="https://groups.google.com/forum/#!topic/psutil-dev/fj8DQ3lGFH4"&gt;7 years ago&lt;/a&gt;.&lt;/p&gt;
&lt;div&gt;
    &lt;a href="/images/me-with-jay.jpg"&gt;
    &lt;img src="/images/me-with-jay.jpg" style="width:750px; height:500px" /&gt;
    &lt;/a&gt;
&lt;/div&gt;&lt;p&gt;Back then I didn't know any C (and I still am a terrible C developer) so he's been crucial to develop the initial psutil skeleton including OSX and Windows support. I'm back home now (but not for long ;-)), so I finally have some time to write this blog post and tell you about the new psutil release. Let's see what happened.&lt;/p&gt;
&lt;div class="section" id="net-if-addrs"&gt;
&lt;h2&gt;net_if_addrs()&lt;/h2&gt;
&lt;p&gt;In a few words, we're now able to list network interface addresses similarly to &amp;quot;ifconfig&amp;quot; command on UNIX:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;psutil&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pprint&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;pprint&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;pprint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;net_if_addrs&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ethernet0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;snic&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AddressFamily&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;10.0.0.4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;netmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;255.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;broadcast&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;10.255.255.255&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
               &lt;span class="n"&gt;snic&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AddressFamily&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_PACKET&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;9c:eb:e8:0b:05:1f&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;netmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;broadcast&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ff:ff:ff:ff:ff:ff&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)],&lt;/span&gt;
 &lt;span class="s1"&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;snic&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AddressFamily&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_INET&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;netmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;255.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;broadcast&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
               &lt;span class="n"&gt;snic&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;AddressFamily&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;AF_PACKET&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;00:00:00:00:00:00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;netmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="n"&gt;broadcast&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;00:00:00:00:00:00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)]}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is limited to &lt;cite&gt;AF_INET&lt;/cite&gt; (IPv4), &lt;cite&gt;AF_INET6&lt;/cite&gt; (IPv6) and &lt;cite&gt;AF_LINK&lt;/cite&gt; (Ethernet) address families. If you want something more poweful (e.g. &lt;cite&gt;AF_BLUETOOTH&lt;/cite&gt;) you can take a look at &lt;a class="reference external" href="https://pypi.python.org/pypi/netifaces/"&gt;netifaces&lt;/a&gt; extension. And here's the code which does these tricks on POSIX and Windows:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/39161251010503d6b087807c473f4fb648dfcbce/psutil/_psutil_posix.c#L151"&gt;POSIX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/39161251010503d6b087807c473f4fb648dfcbce/psutil/_psutil_windows.c#L2907"&gt;Windows&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Also, here's some &lt;a class="reference external" href="https://psutil.readthedocs.io/en/latest/#psutil.net_if_addrs"&gt;doc&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="net-if-stats"&gt;
&lt;h2&gt;net_if_stats()&lt;/h2&gt;
&lt;p&gt;This will return a bunch of information about network interface cards:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;psutil&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pprint&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;pprint&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;pprint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;net_if_stats&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ethernet&amp;#39;&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;snicstats&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;isup&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="n"&gt;duplex&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;NicDuplex&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;NIC_DUPLEX_FULL&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="n"&gt;speed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="n"&gt;mtu&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1500&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
 &lt;span class="s1"&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;snicstats&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;isup&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="n"&gt;duplex&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;NicDuplex&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;NIC_DUPLEX_UNKNOWN&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="n"&gt;speed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                        &lt;span class="n"&gt;mtu&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;65536&lt;/span&gt;&lt;span class="p"&gt;)}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Again, here's the code for each platform:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/39161251010503d6b087807c473f4fb648dfcbce/psutil/_psutil_windows.c#L3057"&gt;Windows&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/39161251010503d6b087807c473f4fb648dfcbce/psutil/_psutil_linux.c#L474"&gt;Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/39161251010503d6b087807c473f4fb648dfcbce/psutil/_psutil_posix.c#L229"&gt;OSX &amp;amp; FreeBSD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/39161251010503d6b087807c473f4fb648dfcbce/psutil/_psutil_sunos.c#L1153"&gt;SunOS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;...and the &lt;a class="reference external" href="https://psutil.readthedocs.io/en/latest/#psutil.net_if_stats"&gt;doc&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="enums"&gt;
&lt;h2&gt;Enums&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://docs.python.org/3/library/enum.html"&gt;Enums&lt;/a&gt; are a nice new feature introduced in Python 3.4. Very briefly (or at least, this is what I appreciate the most about them), they help you write an API with human-readable constants. If you use Python 2 you'll see something like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;psutil&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IOPRIO_CLASS_IDLE&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On Python 3.4 you'll see a more informative:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;psutil&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IOPRIO_CLASS_IDLE&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;IOPriority&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IOPRIO_CLASS_IDLE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;They are backward compatible, meaning if you're sending serialized data produced with psutil through the network you can safely use comparison operators and so on. The psutil APIs returning enums (on Python &amp;gt;=3.4) are:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;cite&gt;psutil.net_connections()&lt;/cite&gt; (the address families):&lt;/li&gt;
&lt;li&gt;&lt;cite&gt;psutil.Process.connections()&lt;/cite&gt; (same as above)&lt;/li&gt;
&lt;li&gt;&lt;cite&gt;psutil.net_if_stats()&lt;/cite&gt;  (all &lt;tt class="docutils literal"&gt;NIC_DUPLEX_*&lt;/tt&gt; constants)&lt;/li&gt;
&lt;li&gt;&lt;cite&gt;psutil.Process.nice()&lt;/cite&gt; on Windows (for all the &lt;tt class="docutils literal"&gt;*_PRIORITY_CLASS&lt;/tt&gt; constants)&lt;/li&gt;
&lt;li&gt;&lt;cite&gt;psutil.Process.ionice()&lt;/cite&gt; on Linux (for all the &lt;tt class="docutils literal"&gt;IOPRIO_CLASS_*&lt;/tt&gt; constants)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All the other existing constants remained plain strings (&lt;tt class="docutils literal"&gt;STATUS_*&lt;/tt&gt;) or integers (&lt;tt class="docutils literal"&gt;CONN_*&lt;/tt&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="zombie-processes"&gt;
&lt;h2&gt;Zombie processes&lt;/h2&gt;
&lt;p&gt;This is a big one. The full story is &lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/428"&gt;here&lt;/a&gt; but basically the support for &lt;a class="reference external" href="http://askubuntu.com/a/48625"&gt;zombie processes&lt;/a&gt; on UNIX was &lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/428"&gt;broken&lt;/a&gt; (except on Linux, and Windows doesn't have zombie processes). Up until psutil 2.X we could instantiate a zombie process:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create_zombie&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Process&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;...but every time we queried it we got a &lt;cite&gt;NoSuchProcess&lt;/cite&gt; exception:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;psutil/__init__.py&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;374&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;_init&lt;/span&gt;
    &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;NoSuchProcess&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;NoSuchProcess&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;process&lt;/span&gt; &lt;span class="n"&gt;found&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="mi"&gt;123&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That was misleading though because the PID technically still existed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pid_exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kc"&gt;True&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Furthermore, depending on what platform you were on, certain process stats could still be queried (instead of raising &lt;cite&gt;NoSuchProcess&lt;/cite&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cmdline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;python&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Also &lt;cite&gt;process_iter()&lt;/cite&gt; did not return zombie processes at all. This was probably the worst aspect because being able to identify them is an important use case, as they signal an issue with process: if a parent process spawns a child, terminates it (via &lt;cite&gt;kill()&lt;/cite&gt;), but doesn't &lt;cite&gt;wait()&lt;/cite&gt; for it it will create a zombie. Long story short, the way this changed in psutil 3.0 is that:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;we now have a new &lt;cite&gt;ZombieProcess&lt;/cite&gt; exception, raised every time we're not able to query a process because it's a zombie&lt;/li&gt;
&lt;li&gt;it is raised instead of &lt;cite&gt;NoSuchProcess&lt;/cite&gt; (which was incorrect and misleading)&lt;/li&gt;
&lt;li&gt;it is still backward compatible (meaning you won't have to change your old code) because it inherits from &lt;cite&gt;NoSuchProcess&lt;/cite&gt;&lt;/li&gt;
&lt;li&gt;&lt;cite&gt;process_iter()&lt;/cite&gt; finally works, meaning you can safely identify zombie processes like this:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;psutil&lt;/span&gt;
&lt;span class="n"&gt;zombies&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;process_iter&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;psutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;STATUS_ZOMBIE&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;zombies&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;NoSuchProcess&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="removal-of-deprecated-apis"&gt;
&lt;h2&gt;Removal of deprecated APIs&lt;/h2&gt;
&lt;p&gt;This is another big one, probably the biggest. In a previous blog post I already talked about deprecated APIs. What I did back then (January 2014) was to rename and officially deprecate different APIs and provide aliases for them so that people wouldn't yell at me because I broke their existent code. The most interesting deprecation was certainly the one affecting module constants and the hack which was used in order to provide &amp;quot;module properties&amp;quot;. With this new release I decided to get rid of all those aliases. I'm sure this will cause problems but hey! This is a new major release, right? =). Plus the amount of crap which was removed is impressive (see the &lt;a class="reference external" href="https://github.com/giampaolo/psutil/commit/ab211934af0acf99091e4cd534fc5bbe7fd3b233"&gt;commit&lt;/a&gt;). Here's the old aliases which are now gone for good (or bad, depending on how much headache they will cause you):&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="removed-module-functions-and-constants"&gt;
&lt;h2&gt;Removed module functions and constants&lt;/h2&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="48%" /&gt;
&lt;col width="52%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Already deprecated name&lt;/th&gt;
&lt;th class="head"&gt;New name&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;psutil.BOOT_TIME()&lt;/td&gt;
&lt;td&gt;psutil.boot_time()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.NUM_CPUS()&lt;/td&gt;
&lt;td&gt;psutil.cpu_count()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.TOTAL_PHYMEM()&lt;/td&gt;
&lt;td&gt;psutil.virtual_memory().total&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.avail_phymem()&lt;/td&gt;
&lt;td&gt;psutil.virtual_memory().free&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.avail_virtmem()&lt;/td&gt;
&lt;td&gt;psutil.swap_memory().free&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.cached_phymem()&lt;/td&gt;
&lt;td&gt;psutil.virtual_memory().cached&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.get_pid_list()&lt;/td&gt;
&lt;td&gt;psutil.pids().cached&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.get_process_list()&lt;/td&gt;
&lt;td&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.get_users()&lt;/td&gt;
&lt;td&gt;psutil.users()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.network_io_counters()&lt;/td&gt;
&lt;td&gt;psutil.net_io_counters()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.phymem_buffers()&lt;/td&gt;
&lt;td&gt;psutil.virtual_memory().buffers&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.phymem_usage()&lt;/td&gt;
&lt;td&gt;psutil.virtual_memory()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.total_virtmem()&lt;/td&gt;
&lt;td&gt;psutil.swap_memory().total&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.used_virtmem()&lt;/td&gt;
&lt;td&gt;psutil.swap_memory().used&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.used_phymem()&lt;/td&gt;
&lt;td&gt;psutil.virtual_memory().used&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;psutil.virtmem_usage()&lt;/td&gt;
&lt;td&gt;psutil.swap_memory()&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Process methods (assuming &lt;cite&gt;p = psutil.Process()&lt;/cite&gt;):&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="48%" /&gt;
&lt;col width="52%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Already deprecated name&lt;/th&gt;
&lt;th class="head"&gt;New name&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;p.get_children()&lt;/td&gt;
&lt;td&gt;p.children()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_connections()&lt;/td&gt;
&lt;td&gt;p.connections()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_cpu_affinity()&lt;/td&gt;
&lt;td&gt;p.cpu_affinity()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_cpu_percent()&lt;/td&gt;
&lt;td&gt;p.cpu_percent()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_cpu_times()&lt;/td&gt;
&lt;td&gt;p.cpu_times()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_io_counters()&lt;/td&gt;
&lt;td&gt;p.io_counters()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_ionice()&lt;/td&gt;
&lt;td&gt;p.ionice()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_memory_info()&lt;/td&gt;
&lt;td&gt;p.memory_info()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_ext_memory_info()&lt;/td&gt;
&lt;td&gt;p.memory_info_ex()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_memory_maps()&lt;/td&gt;
&lt;td&gt;p.memory_maps()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_memory_percent()&lt;/td&gt;
&lt;td&gt;p.memory_percent()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_nice()&lt;/td&gt;
&lt;td&gt;p.nice()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_num_ctx_switches()&lt;/td&gt;
&lt;td&gt;p.num_ctx_switches()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_num_fds()&lt;/td&gt;
&lt;td&gt;p.num_fds()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_num_threads()&lt;/td&gt;
&lt;td&gt;p.num_threads()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_open_files()&lt;/td&gt;
&lt;td&gt;p.open_files()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_rlimit()&lt;/td&gt;
&lt;td&gt;p.rlimit()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.get_threads()&lt;/td&gt;
&lt;td&gt;p.threads()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.getcwd()&lt;/td&gt;
&lt;td&gt;p.cwd()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.set_cpu_affinity()&lt;/td&gt;
&lt;td&gt;p.cpu_affinity()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.set_ionice()&lt;/td&gt;
&lt;td&gt;p.ionice()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.set_nice()&lt;/td&gt;
&lt;td&gt;p.nice()&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;p.set_rlimit()&lt;/td&gt;
&lt;td&gt;p.rlimit()&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;If your code suddenly breaks with AttributeError after you upgraded psutil it means you were using one of those deprecated aliases. In that case just take a look at the table above and rename stuff in accordance.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="bug-fixes"&gt;
&lt;h2&gt;Bug fixes&lt;/h2&gt;
&lt;p&gt;I fixed a lot of stuff (full list &lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/master/HISTORY.rst"&gt;here&lt;/a&gt;), but here's the list of things which I think are worth mentioning:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/512"&gt;#512&lt;/a&gt;: [FreeBSD] fix segfault in net_connections().&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/593"&gt;#593&lt;/a&gt;: [FreeBSD] Process.memory_maps() segfaults.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/606"&gt;#606&lt;/a&gt;: Process.parent() may swallow NoSuchProcess exceptions.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/614"&gt;#614&lt;/a&gt;: [Linux]: cpu_count(logical=False) return the number of physical CPUs instead of physical cores.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/628"&gt;#628&lt;/a&gt;: [Linux] Process.name() truncates process name in case it contains spaces or parentheses.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="ease-of-development"&gt;
&lt;h2&gt;Ease of development&lt;/h2&gt;
&lt;p&gt;These are not enhancements you will directly benefit from but I put some effort into making my life easier every time I work on psutil.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;I care about psutil code being fully &lt;a class="reference external" href="https://www.python.org/dev/peps/pep-0008/"&gt;PEP8&lt;/a&gt; compliant so I added a &lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/master/.git-pre-commit"&gt;pre-commit&lt;/a&gt; GIT hook which runs &lt;a class="reference external" href="https://pypi.python.org/pypi/flake8"&gt;flake8&lt;/a&gt; on every commit and rejects it if the coding style is not compliant. The way I install this is via &lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/82da82a6bb94ed5c6faf9d762ef4ad0fec18f01b/Makefile#L108)"&gt;make install-git-hooks&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;I added a &lt;tt class="docutils literal"&gt;make &lt;span class="pre"&gt;install-dev-deps&lt;/span&gt;&lt;/tt&gt; command which installs all deps and stuff which is useful for testing (&lt;cite&gt;ipdb&lt;/cite&gt;, &lt;cite&gt;coverage&lt;/cite&gt;, etc).&lt;/li&gt;
&lt;li&gt;A new &lt;tt class="docutils literal"&gt;make coverage&lt;/tt&gt; command which runs &lt;a class="reference external" href="http://nedbatchelder.com/code/coverage/"&gt;coverage&lt;/a&gt;. With this I discovered some of parts in the code which weren't covered by tests and I fixed that.&lt;/li&gt;
&lt;li&gt;I started using &lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/master/tox.ini"&gt;tox&lt;/a&gt; to easily test psutil against all supported Python versions (from 2.6 to 3.4) in one shot.&lt;/li&gt;
&lt;li&gt;I &lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/629"&gt;reorganized tests&lt;/a&gt; so that now they can be easily executed with py.test and nose (before, only unittest runner was fully supported)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="final-words"&gt;
&lt;h2&gt;Final words&lt;/h2&gt;
&lt;p&gt;I must say I'm pretty satisfied with how psutil is going and the satisfaction I still get every time I work on it. Right now it gets almost &lt;a class="reference external" href="https://pypi.python.org/pypi/psutil#downloads"&gt;800.000 download a month&lt;/a&gt;, which is pretty great for a Python library. As of right now I consider psutil almost &amp;quot;completed&amp;quot; in terms of features, meaning I'm basically running out of ideas on what I should add next (see &lt;a class="reference external" href="https://github.com/giampaolo/psutil/blob/master/TODO"&gt;TODO&lt;/a&gt;). From now on the future development will probably focus on adding support for more exotic platforms (&lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/562"&gt;OpenBSD&lt;/a&gt;, &lt;a class="reference external" href="https://github.com/giampaolo/psutil/pull/557"&gt;NetBSD&lt;/a&gt;, &lt;a class="reference external" href="https://github.com/giampaolo/psutil/issues/355"&gt;Android&lt;/a&gt;). There also have been some discussions on python-ideas mailing list about &lt;a class="reference external" href="https://mail.python.org/pipermail//python-ideas/2014-October/029835.html"&gt;including psutil into Python stdlib&lt;/a&gt; but, assuming that will ever happen, it's still far away in the future as it would require a lot of time which I currently don't have. That should be all. I hope you will all enjoy this new release.&lt;/p&gt;
&lt;/div&gt;
</content><category term="2015"></category><category term="psutil"></category><category term="travel"></category><category term="personal"></category><category term="python"></category></entry></feed>