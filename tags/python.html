<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <!--<title>Giampaolo Rodola - python</title>-->
    <title>Giampaolo Rodola</title>
    <link rel="stylesheet" href="https://gmpy.dev/theme/css/main.css" />
    <link href="https://gmpy.dev/feeds/atom.all.xml" type="application/atom+xml" rel="alternate" title="Giampaolo Rodola Atom Feed" />
    <link href="https://gmpy.dev/feeds/rss.all.xml" type="application/rss+xml" rel="alternate" title="Giampaolo Rodola RSS Feed" />
    <link rel="icon" type="image/x-icon" href="https://gmpy.dev/favicon.ico">
</head>

<body id="index" class="home">
    <header id="banner" class="body">
        <h1><a href="https://gmpy.dev/about">Giampaolo Rodola <strong>Python enthusiast, core developer, psutil author</strong></a></h1>
        <nav><ul>
            <li><a href="/">Blog</a></li>
            <li><a href="/archives">Archives</a></li>
            <li><a href="/donate">Donate</a></li>
            <li><a href="/about">About</a></li>
        </ul></nav>
    </header><!-- /#banner -->

<section id="content" class="body">
    <h1 class="entry-title">Blog posts for tags/python</h1>

<!-- blog posts -->
        <ol id="posts-list" class="hfeed" start="4">
    <li><article class="hentry">
        <header>
            <h1><a href="https://gmpy.dev/blog/2025/psutil-drop-python-27-support" rel="bookmark"
                   title="Permalink to psutil: drop Python 2.7 support">psutil: drop Python 2.7 support</a></h1>
        </header>
        <div class="entry-content">
<footer class="post-info">
        <a class="published" title="2025-02-13T00:00:00+01:00">
        Created: 13 Feb 2025,
        </a>
<!--
        <address class="vcard author">
                By                         <a class="url fn" href="https://gmpy.dev/author/giampaolo-rodola.html">Giampaolo Rodola</a>
        </address>
-->
    <a>Tags:
        <a href="https://gmpy.dev/tags/psutil">psutil</a>,        <a href="https://gmpy.dev/tags/python">python</a>    </a>

<!--
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="grodola">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
-->
</footer><!-- /.post-info -->            <p>About dropping Python 2.7 support, 3 years ago <a href="https://github.com/giampaolo/psutil/issues/2014#issuecomment-969263432">I stated</a>:</p>
<blockquote>
<p>Not a chance, for many years to come. [Python 2.7] currently represents 7-10%
of total downloads, meaning around 70k / 100k downloads per day.</p>
</blockquote>
<p>Only 3 years later, and to my surprise, <strong>downloads for Python 2.7 dropped to
0.36%</strong>! As such, as of psutil 7.0.0, I finally decided to drop support for
Python 2.7!</p>
<h2>The numbers</h2>
<p>These are downloads per month:</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">pypinfo</span><span class="w"> </span><span class="o">--</span><span class="n">percent</span><span class="w"> </span><span class="n">psutil</span><span class="w"> </span><span class="n">pyversion</span>
<span class="n">Served</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">cache</span><span class="p">:</span><span class="w"> </span><span class="n">False</span>
<span class="n">Data</span><span class="w"> </span><span class="n">processed</span><span class="p">:</span><span class="w"> </span><span class="mf">4.65</span><span class="w"> </span><span class="n">GiB</span>
<span class="n">Data</span><span class="w"> </span><span class="n">billed</span><span class="p">:</span><span class="w"> </span><span class="mf">4.65</span><span class="w"> </span><span class="n">GiB</span>
<span class="n">Estimated</span><span class="w"> </span><span class="n">cost</span><span class="p">:</span><span class="w"> </span><span class="o">$</span><span class="mf">0.03</span>

<span class="o">|</span><span class="w"> </span><span class="n">python_version</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">percent</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">download_count</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="o">--------------</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">-------</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">--------------</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.10</span><span class="w">           </span><span class="o">|</span><span class="w">  </span><span class="mf">23.84</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">26</span><span class="p">,</span><span class="mi">354</span><span class="p">,</span><span class="mi">506</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.8</span><span class="w">            </span><span class="o">|</span><span class="w">  </span><span class="mf">18.87</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">20</span><span class="p">,</span><span class="mi">862</span><span class="p">,</span><span class="mi">015</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.7</span><span class="w">            </span><span class="o">|</span><span class="w">  </span><span class="mf">17.38</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">19</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">960</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.9</span><span class="w">            </span><span class="o">|</span><span class="w">  </span><span class="mf">17.00</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">18</span><span class="p">,</span><span class="mi">798</span><span class="p">,</span><span class="mi">843</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.11</span><span class="w">           </span><span class="o">|</span><span class="w">  </span><span class="mf">13.63</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">15</span><span class="p">,</span><span class="mi">066</span><span class="p">,</span><span class="mi">706</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.12</span><span class="w">           </span><span class="o">|</span><span class="w">   </span><span class="mf">7.01</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">7</span><span class="p">,</span><span class="mi">754</span><span class="p">,</span><span class="mi">751</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.13</span><span class="w">           </span><span class="o">|</span><span class="w">   </span><span class="mf">1.15</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="p">,</span><span class="mi">267</span><span class="p">,</span><span class="mi">008</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.6</span><span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="mf">0.73</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">803</span><span class="p">,</span><span class="mi">189</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">2.7</span><span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="mf">0.36</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">402</span><span class="p">,</span><span class="mi">111</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mf">3.5</span><span class="w">            </span><span class="o">|</span><span class="w">   </span><span class="mf">0.03</span><span class="o">%</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">28</span><span class="p">,</span><span class="mi">656</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Total</span><span class="w">          </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">    </span><span class="mi">110</span><span class="p">,</span><span class="mi">555</span><span class="p">,</span><span class="mi">745</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<p>According to <a href="https://archive.is/wip/knzql">pypistats.org</a> Python 2.7 downloads
are 0.28% of the total, around 15.000 downloads per day.</p>
<h2>The pain</h2>
<p>Maintaining 2.7 support in psutil had become increasingly difficult, but still
possible. E.g. I could still run tests by using <a href="https://github.com/giampaolo/psutil/blob/fbb6d9ce98f930d3d101b7df5a4f4d0f1d2b35a3/setup.py#L76-L85">old PYPI
backports</a>.
GitHub Actions could still be
<a href="https://github.com/giampaolo/psutil/blob/fbb6d9ce98f930d3d101b7df5a4f4d0f1d2b35a3/.github/workflows/build.yml#L77-L112">tweaked</a>
to run tests and produce wheels on Linux and macOS. Not on Windows though, for
which we have to use a separate service (Appveyor).
Still, the amount of hacks in psutil source code necessary to support Python
2.7 piled up over the years, and became quite big. Some disadvantages that come
to mind:</p>
<ul>
<li>Having to maintain a Python compatibility layers like
  <a href="https://github.com/giampaolo/psutil/blob/fbb6d9ce98f930d3d101b7df5a4f4d0f1d2b35a3/psutil/_compat.py">psutil/_compat.py</a>.
  This translated in extra extra code and extra imports.</li>
<li>The C compatibility layer to differentiate between Python 2 and 3 (<code>#if
  PY_MAJOR_VERSION &lt;= 3</code>, etc.).</li>
<li>Dealing with the string vs. unicode differences, both in Python and in C.</li>
<li>Inability to use modern language features, especially f-strings.</li>
<li>Inability to freely use <code>enum</code>s, which created a difference on how CONSTANTS
  were exposed in terms of API.</li>
<li>Having to install a specific version of <code>pip</code> and other (outdated)
  <a href="https://github.com/giampaolo/psutil/blob/fbb6d9ce98f930d3d101b7df5a4f4d0f1d2b35a3/setup.py#L76-L85">deps</a>.</li>
<li>Relying on the third-party Appveyor CI service to run tests and produce 2.7
  wheels.</li>
<li>Running 4 extra CI jobs on every commit (Linux, macOS, Windows 32-bit,
  Windows 64-bit) making the CI slower and more subject to failures (we have
  quite a bit of flaky tests).</li>
<li>The distribution of 7 wheels specific for Python 2.7. E.g. in the previous
  release I had to upload:</li>
</ul>
<div class="highlight"><pre><span></span><code>psutil-6.1.1-cp27-cp27m-macosx_10_9_x86_64.whl
psutil-6.1.1-cp27-none-win32.whl
psutil-6.1.1-cp27-none-win_amd64.whl
psutil-6.1.1-cp27-cp27m-manylinux2010_i686.whl
psutil-6.1.1-cp27-cp27m-manylinux2010_x86_64.whl
psutil-6.1.1-cp27-cp27mu-manylinux2010_i686.whl
psutil-6.1.1-cp27-cp27mu-manylinux2010_x86_64.whl
</code></pre></div>

<h2>The removal</h2>
<p>The removal was done in
<a href="https://github.com/giampaolo/psutil/pull/2481">PR-2841</a>, which removed around
1500 lines of code (nice!). <strong>It felt liberating</strong>. In doing so, in the doc I
still made the promise that the 6.1.* serie will keep supporting Python 2.7
and will receive <strong>critical bug-fixes only</strong> (no new features). It will be
maintained in a specific <a href="https://github.com/giampaolo/psutil/tree/python2">python2
branch</a>. I explicitly kept
the
<a href="https://github.com/giampaolo/psutil/blob/fbb6d9ce98f930d3d101b7df5a4f4d0f1d2b35a3/setup.py">setup.py</a>
script compatible with Python 2.7 in terms of syntax, so that it can emit an
informative error message on pip install. The user trying to install psutil on
Python 2.7 will see:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip2<span class="w"> </span>install<span class="w"> </span>psutil
As<span class="w"> </span>of<span class="w"> </span>version<span class="w"> </span><span class="m">7</span>.0.0<span class="w"> </span>psutil<span class="w"> </span>no<span class="w"> </span>longer<span class="w"> </span>supports<span class="w"> </span>Python<span class="w"> </span><span class="m">2</span>.7.
Latest<span class="w"> </span>version<span class="w"> </span>supporting<span class="w"> </span>Python<span class="w"> </span><span class="m">2</span>.7<span class="w"> </span>is<span class="w"> </span>psutil<span class="w"> </span><span class="m">6</span>.1.X.
Install<span class="w"> </span>it<span class="w"> </span>with:<span class="w"> </span><span class="s2">&quot;pip2 install psutil==6.1.*&quot;</span>.
</code></pre></div>

<h2>Related tickets</h2>
<ul>
<li>2017-06: <a href="https://github.com/giampaolo/psutil/issues/1053">#1053</a></li>
<li>2022-04: <a href="https://github.com/giampaolo/psutil/pull/2099">#2099</a></li>
<li>2023-04: <a href="https://github.com/giampaolo/psutil/pull/2246">#2246</a></li>
<li>2024-12: <a href="https://github.com/giampaolo/pyftpdlib/pull/635">#635</a></li>
</ul>
        </div>
            <div class="blogposts-separator"></div>
    </article></li>
    <li><article class="hentry">
        <header>
            <h1><a href="https://gmpy.dev/blog/2023/recognize-connection-errors" rel="bookmark"
                   title="Permalink to Recognize connection errors">Recognize connection errors</a></h1>
        </header>
        <div class="entry-content">
<footer class="post-info">
        <a class="published" title="2023-03-16T00:00:00+01:00">
        Created: 16 Mar 2023,
        </a>
<!--
        <address class="vcard author">
                By                         <a class="url fn" href="https://gmpy.dev/author/giampaolo-rodola.html">Giampaolo Rodola</a>
        </address>
-->
    <a>Tags:
        <a href="https://gmpy.dev/tags/python">python</a>,        <a href="https://gmpy.dev/tags/socket">socket</a>,        <a href="https://gmpy.dev/tags/network">network</a>    </a>

<!--
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="grodola">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
-->
</footer><!-- /.post-info -->            <p>Lately I've been dealing with an asynchronous TCP client app which sends
messages to a remote server. Some of these messages are important, and cannot
get lost. Because the connection may drop at any time, I had to implement a
mechanism to resend the message once the client reconnects. As such, I needed
a way to identify what constitutes a <strong>connection error</strong>.</p>
<p>Python provides a builtin <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ConnectionError">ConnectionError</a> exception precisely for this
purpose, but it turns out it's not enough. After observing logs in production,
I found some errors that were not related to the socket connection per se, but
rather to the <strong>system connectivity</strong>, like <cite>ENETUNREACH</cite>
(&quot;network unreachable&quot;) or <cite>ENETDOWN</cite> (&quot;network down&quot;).  It's interesting to
note how this distinction is reflected in the UNIX <a class="reference external" href="https://www.thegeekstuff.com/2010/10/linux-error-codes/">errno</a>  code prefixes:
<cite>ECONN*</cite> (connection errors) vs. <cite>ENET*</cite> (network errors). I've noticed
<cite>ENET*</cite> errors usually occur on a DHCP renewal, or more in general when the
Wi-Fi signal is weak or absent. Because this code runs on a cleaning robot
which constantly moves around the house, connection can become unstable when
the robot gets far from the Wi-Fi Access Point, so it's pretty common to bump
into errors like these:</p>
<pre class="literal-block">
File &quot;/usr/lib/python3.7/ssl.py&quot;, line 934, in send
    return self._sslobj.write(data)
OSError: [Errno 101] Network is unreachable

File &quot;/usr/lib/python3.7/socket.py&quot;, line 222, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
socket.gaierror: [Errno -3] Temporary failure in name resolution

File &quot;/usr/lib/python3.7/ssl.py&quot;, line 934, in send
    return self._sslobj.write(data)
BrokenPipeError: [Errno 32] Broken pipe

File &quot;/usr/lib/python3.7/ssl.py&quot;, line 934, in send
    return self._sslobj.write(data)
socket.timeout: The write operation timed out
</pre>
<p>Production logs also revealed a considerable amount of SSL-related errors. I
was uncertain what to do about those. The app is supposed to gracefully handle
them, so theoretically they should represent a bug. Still, they are
unequivocally related to the connection stream, and represent a failed attempt
to send data, so we want to retry it. Example of logs I found:</p>
<pre class="literal-block">
File &quot;/usr/lib/python3.7/ssl.py&quot;, line 934, in send
    return self._sslobj.write(data)
ssl.SSLZeroReturnError: TLS/SSL connection has been closed (EOF)

File &quot;/usr/lib/python3.7/ssl.py&quot;, line 934, in send
    return self._sslobj.write(data)
ssl.SSLError: [SSL: BAD_LENGTH] bad length
</pre>
<p>Looking at production logs revealed what sort of brutal, rough and tumble place
the Internet is, and how a network app must be ready to handle all sorts of
unexpected error conditions which hardly show up during testing. To handle all
of these cases I came up with this solution which I think is worth sharing, as
it's generic enough to be reused in similar situations. If needed, this can be
easily extended to include specific exceptions of third party libraries, like
<cite>requests.exceptions.ConnectionError</cite>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">errno</span><span class="o">,</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">ssl</span>

<span class="c1"># Network errors, usually related to DHCP or wpa_supplicant (Wi-Fi).</span>
<span class="n">NETWORK_ERRNOS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">((</span>
    <span class="n">errno</span><span class="o">.</span><span class="n">ENETUNREACH</span><span class="p">,</span>  <span class="c1"># &quot;Network is unreachable&quot;</span>
    <span class="n">errno</span><span class="o">.</span><span class="n">ENETDOWN</span><span class="p">,</span>  <span class="c1"># &quot;Network is down&quot;</span>
    <span class="n">errno</span><span class="o">.</span><span class="n">ENETRESET</span><span class="p">,</span>  <span class="c1"># &quot;Network dropped connection on reset&quot;</span>
    <span class="n">errno</span><span class="o">.</span><span class="n">ENONET</span><span class="p">,</span>  <span class="c1"># &quot;Machine is not on the network&quot;</span>
<span class="p">))</span>

<span class="k">def</span> <span class="nf">is_connection_err</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if an exception is connection-related.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">):</span>
        <span class="c1"># https://docs.python.org/3/library/exceptions.html#ConnectionError</span>
        <span class="c1"># ConnectionError includes:</span>
        <span class="c1"># * BrokenPipeError (EPIPE, ESHUTDOWN)</span>
        <span class="c1"># * ConnectionAbortedError (ECONNABORTED)</span>
        <span class="c1"># * ConnectionRefusedError (ECONNREFUSED)</span>
        <span class="c1"># * ConnectionResetError (ECONNRESET)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">):</span>
        <span class="c1"># failed DNS resolution on connect()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">)):</span>
        <span class="c1"># timeout on connect(), recv(), send()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="c1"># ENOTCONN == &quot;Transport endpoint is not connected&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">errno</span> <span class="ow">in</span> <span class="n">NETWORK_ERRNOS</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOTCONN</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLError</span><span class="p">):</span>
        <span class="c1"># Let&#39;s consider any SSL error a connection error. Usually this is:</span>
        <span class="c1"># * ssl.SSLZeroReturnError: &quot;TLS/SSL connection has been closed&quot;</span>
        <span class="c1"># * ssl.SSLError: [SSL: BAD_LENGTH]</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
<p>To use it:</p>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;hello there&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_connection_err</span><span class="p">(</span><span class="n">err</span><span class="p">):</span>
        <span class="n">schedule_on_reconnect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;hello there&quot;</span><span class="p">))</span>
    <span class="k">raise</span>
</pre></div>
<div class="section" id="external-links">
<h2>External Links<a class="headerlink" href="#external-links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Github <a class="reference external" href="https://gist.github.com/giampaolo/905b38a5ea9d5179eb0138e2f37a01a8">Gist</a></li>
</ul>
</div>

        </div>
            <div class="blogposts-separator"></div>
    </article></li>
    <li><article class="hentry">
        <header>
            <h1><a href="https://gmpy.dev/blog/2022/sublime-text-remember-cursor-position-plugin" rel="bookmark"
                   title="Permalink to Sublime Text: remember cursor position plugin">Sublime Text: remember cursor position plugin</a></h1>
        </header>
        <div class="entry-content">
<footer class="post-info">
        <a class="published" title="2022-03-18T00:00:00+01:00">
        Created: 18 Mar 2022,
        </a>
<!--
        <address class="vcard author">
                By                         <a class="url fn" href="https://gmpy.dev/author/giampaolo-rodola.html">Giampaolo Rodola</a>
        </address>
-->
    <a>Tags:
        <a href="https://gmpy.dev/tags/sublime">sublime</a>,        <a href="https://gmpy.dev/tags/python">python</a>    </a>

<!--
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="grodola">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
-->
</footer><!-- /.post-info -->            <p>My editor of choice for Python development is Sublime Text.
It has been for a very long time (10 years).
It's fast, minimalist and straight to the point, which is why I always resisted
the temptation to use more advanced and modern IDEs such as PyCharm or VS code,
which admittedly have superior auto-completion and refactoring tools.</p>
<p>There is a very simple feature I've always missed in ST: the
possibility to &quot;remember&quot; / save the cursor position when a file is closed.
The only plugin promising to do such a thing is called
<a class="reference external" href="https://github.com/titoBouzout/BufferScroll">BufferScroll</a>, but for some
reason it ceased working for me at some point.
I spent a considerable amount of time Googling for an alternative but, to my
surprise, I couldn't find any plugin which implements such a simple feature.
Therefore today I decided to bite the bullet and try to implement this myself,
by writing my first ST plugin, which I paste below.</p>
<p>What it does is this:</p>
<ul class="simple">
<li>every time a file is closed, save the cursor position (x and y axis) to a JSON file</li>
<li>if that same file is re-opened, restore the cursor at that position</li>
</ul>
<p>What's neat about ST plugins is that they are just Python files which you can
install by copying them in ST's config directory. On Linux you can copy the
script below in:</p>
<p><tt class="docutils literal"><span class="pre">~/.config/sublime-text-3/Packages/User/cursor_positions.py</span></tt></p>
<p>...and will work out of the box.
This is exactly the kind of minimalism which I love about ST, and which I've
always missed in other IDEs.</p>
<div class="highlight"><pre><span></span><span class="c1"># cursor_positions.py</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A plugin for SublimeText which saves (remembers) cursor position when</span>
<span class="sd">a file is closed.</span>
<span class="sd">Install it by copying this file in ~/.config/sublime-text-3/Packages/User/</span>
<span class="sd">directory (Linux).</span>

<span class="sd">Author: Giampaolo Rodola&#39;</span>
<span class="sd">License: MIT</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">import</span> <span class="nn">sublime</span>
<span class="kn">import</span> <span class="nn">sublime_plugin</span>


<span class="n">SUBLIME_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sublime</span><span class="o">.</span><span class="n">packages_path</span><span class="p">(),</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="n">SESSION_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">SUBLIME_ROOT</span><span class="p">,</span> <span class="s2">&quot;Local&quot;</span><span class="p">,</span> <span class="s2">&quot;cursor_positions.session.json&quot;</span><span class="p">)</span>
<span class="c1"># when reading the session file on startup, we&#39;ll remove entries</span>
<span class="c1"># older than X days</span>
<span class="n">RM_FILE_OLDER_THAN_DAYS</span> <span class="o">=</span> <span class="mi">180</span>


<span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">: &quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Session</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">SESSION_FILE</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_old_entries</span><span class="p">()</span>

    <span class="c1"># --- file</span>

    <span class="k">def</span> <span class="nf">read_session_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">SESSION_FILE</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">write_session_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># Use the same FS so that the move operation is atomic:</span>
        <span class="c1"># https://stackoverflow.com/a/18706666</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
                <span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">SESSION_FILE</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">SESSION_FILE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prune_old_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_session_file</span><span class="p">()</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">old</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tstamp</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;last_update&quot;</span><span class="p">]</span>
            <span class="n">last_update</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">tstamp</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">delta_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">last_update</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="n">delta_days</span> <span class="o">&gt;</span> <span class="n">RM_FILE_OLDER_THAN_DAYS</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="s2">&quot;removing old saved file </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">new</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">new</span> <span class="o">!=</span> <span class="n">old</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_session_file</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>

    <span class="c1"># --- operations</span>

    <span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_session_file</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">last_update</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_session_file</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_session_file</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>


<span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Events</span><span class="p">(</span><span class="n">sublime_plugin</span><span class="o">.</span><span class="n">EventListener</span><span class="p">):</span>

    <span class="c1"># --- utils</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_cursor_pos</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">rowcol</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">sel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">begin</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_cursor_pos</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">text_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">sel</span><span class="p">()</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">view</span><span class="o">.</span><span class="n">sel</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sublime</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>
        <span class="n">view</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">file_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># non-existent file</span>
        <span class="n">log</span><span class="p">(</span><span class="s2">&quot;saving cursor position for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_pos</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="n">session</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_cursor_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">load_entry</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">file_name</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">entry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cursor_pos</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>

    <span class="c1"># --- callbacks</span>

    <span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="c1"># called when a file is closed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_cursor_position</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="c1"># called when a file is opened</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_cursor_position</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
</pre></div>

        </div>
            <div class="blogposts-separator"></div>
    </article></li>
    <li><article class="hentry">
        <header>
            <h1><a href="https://gmpy.dev/blog/2020/new-pelican-website" rel="bookmark"
                   title="Permalink to New Pelican website">New Pelican website</a></h1>
        </header>
        <div class="entry-content">
<footer class="post-info">
        <a class="published" title="2020-06-26T00:00:00+02:00">
        Created: 26 Jun 2020,
        </a>
<!--
        <address class="vcard author">
                By                         <a class="url fn" href="https://gmpy.dev/author/giampaolo-rodola.html">Giampaolo Rodola</a>
        </address>
-->
    <a>Tags:
        <a href="https://gmpy.dev/tags/announce">announce</a>,        <a href="https://gmpy.dev/tags/python">python</a>,        <a href="https://gmpy.dev/tags/pelican">pelican</a>,        <a href="https://gmpy.dev/tags/psutil">psutil</a>    </a>

<!--
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="grodola">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
-->
</footer><!-- /.post-info -->            <p>Hello there. I present you my new blog / personal website!
This is something I've been wanting to do for a very long time, since the old blog hosted at <a class="reference external" href="https://grodola.blogspot.com/">https://grodola.blogspot.com/</a> was... well, too old. =)
This new site is based on <a class="reference external" href="https://docs.getpelican.com/en/stable/">Pelican</a>, a static website generator similar to <a class="reference external" href="https://jekyllrb.com/">Jekyll</a>. Differently from Jekyll, it uses Python instead of Ruby, and that's why I chose it. It's minimal, straight to the point and I feel I have control of things. This is what Pelican gave me out of the box:</p>
<ul class="simple">
<li>blog functionality</li>
<li>ability to write content by using reStructuredText</li>
<li>RSS &amp; Atom feed</li>
<li>easy integration with GitHub pages</li>
<li>ability to add comments via Disqus</li>
</ul>
<p>To this I added a mailing list (I used feedburner), so that users can subscribe and receive an email every time I make a new blog post. As you can see the website is very simple, but it's exactly what I wanted (minimalism). As for the domain name I opted for <a class="reference external" href="https://gmpy.dev/">gmpy.dev</a>, mostly because I know my name is hard to type and pronounce for non-english speakers. And also because I couldn't come up with a better name. ;)</p>
<div class="section" id="git-based-workflow">
<h2>GIT-based workflow<a class="headerlink" href="#git-based-workflow" title="Permalink to this headline">¶</a></h2>
<p>The main reason why I blogged so rarely over the years was mostly because blogger.com provided me no way to edit content in RsT or markdown, and the lack of GIT integration. This made me lazy. With Pelican + GitHub pages the workflow to create and publish new content is very straightforward. I use 2 branches: <a class="reference external" href="https://github.com/giampaolo/giampaolo.github.io/tree/gh-pages">gh-pages</a>, which is the source code of this web-site, and <a class="reference external" href="https://github.com/giampaolo/giampaolo.github.io/tree/master">master</a>, which is where the generated HTML content lives and it is being served by GitHub pages. This is what I do when I have to create a new blog post:</p>
<ul class="simple">
<li>under <cite>gh-pages</cite> branch I create a new file, e.g. <cite>content/blog/2020/new-blog-post.rst</cite>:</li>
</ul>
<div class="highlight"><pre><span></span><span class="gh">New blog post</span>
<span class="gh">#############</span>

<span class="nc">:date:</span> 2020-06-26
<span class="nc">:tags:</span> announce, python

Hello world!
</pre></div>
<ul class="simple">
<li>commit it:</li>
</ul>
<div class="highlight"><pre><span></span>git add content/blog/2020/new-blog-post.rst
git ci -am &quot;new blog post&quot;
git push
</pre></div>
<ul class="simple">
<li>publish it:</li>
</ul>
<div class="highlight"><pre><span></span>make github
</pre></div>
<p>Within 1 minute or something, GitHub will automatically serve <a class="reference external" href="https://gmpy.dev/">gmpy.dev</a> with the updated content. And this is why I think I will start blogging more often. =)
The core of Pelican is <a class="reference external" href="https://github.com/giampaolo/giampaolo.github.io/blob/gh-pages/pelicanconf.py">pelicanconf.py</a>, which lets you customize a lot of things by remaining independent from the theme. I still ended up modifying the default theme though, writing a customized &quot;archives&quot; view and editing CSS to make the site look better on mobile phones. All in all, I am very satisfied with Pelican, and I'm keen on recommending it to anyone who doesn't need dynamism.</p>
</div>
<div class="section" id="about-me">
<h2>About me<a class="headerlink" href="#about-me" title="Permalink to this headline">¶</a></h2>
<p>I spent most of last year (2019) in China, dating my girlfriend, remote working from a shared office space in Shenzhen, and I even taught some Python to a class of Chinese folks with no previous programming experience. The course was about the basics of the language + basic filesystem operations, and the most difficult thing to explain was indentation. I guess that shows the difference between knowing a language and knowing how to teach it.</p>
<p>I got back to Italy in December 2020, just before the pandemic occurred. Because of my connections with China, I knew about the incoming pandemic sooner than the rest of my friends, which for a while (until the lockdown) made them think I was crazy. =)</p>
<p>Since I knew I would be stuck at home for a long time, I bought a quite nice acoustic guitar (Taylor) after many years, and resumed playing (and singing). I learned a bunch of new songs, mostly about Queen, including Bohemian Rhapsody, which is something I've been wanting to do since forever.</p>
<p>I also spent some time working on a personal project that I'm keeping private for the moment, something to speed up file copies, which follows the experiments I made in <a class="reference external" href="https://bugs.python.org/issue33671">BPO-33671</a>. It's still very beta, but I managed to make file copies around 170% faster compared to <tt class="docutils literal">cp</tt> command on Linux, which is pretty impressive (and I think I can push it even further). I will blog about that once I'll have something more solid / stable. Most likely it'll become my next OSS project, even tough I have mixed feelings about that, since the amount of time I'm devoting to psutil is already a lot.</p>
<p>Speaking of which, today I'm also releasing <a class="reference external" href="https://groups.google.com/forum/#!topic/psutil/zT0jUE2IaE4">psutil 5.7.1</a>, which adds support for <strong>Windows Nano</strong>.</p>
<p>I guess this is all. Cheers and subscribe!</p>
</div>

        </div>
            <div class="blogposts-separator"></div>
    </article></li>
    <li><article class="hentry">
        <header>
            <h1><a href="https://gmpy.dev/blog/2019/system-load-average-on-windows-in-python" rel="bookmark"
                   title="Permalink to System load average on Windows in Python">System load average on Windows in Python</a></h1>
        </header>
        <div class="entry-content">
<footer class="post-info">
        <a class="published" title="2019-05-29T00:00:00+02:00">
        Created: 29 May 2019,
        </a>
<!--
        <address class="vcard author">
                By                         <a class="url fn" href="https://gmpy.dev/author/giampaolo-rodola.html">Giampaolo Rodola</a>
        </address>
-->
    <a>Tags:
        <a href="https://gmpy.dev/tags/psutil">psutil</a>,        <a href="https://gmpy.dev/tags/windows">windows</a>,        <a href="https://gmpy.dev/tags/unittest">unittest</a>,        <a href="https://gmpy.dev/tags/travel">travel</a>,        <a href="https://gmpy.dev/tags/python">python</a>    </a>

<!--
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="grodola">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
-->
</footer><!-- /.post-info -->            <p>New <a class="reference external" href="https://github.com/giampaolo/psutil/">psutil</a> 5.6.2 release implements an emulation of <a class="reference external" href="https://docs.python.org/3/library/os.html#os.getloadavg">os.getloadavg()</a> on Windows which was kindly <a class="reference external" href="https://github.com/giampaolo/psutil/pull/1485">contributed by Ammar Askar</a> who originally implemented it for <a class="reference external" href="https://github.com/python/cpython/pull/8357/files">cPython's test suite</a>. This idea has been floating around for quite a while. The first proposal dates back to <a class="reference external" href="https://code.google.com/archive/p/psutil/issues/139">2010</a>, when psutil was still hosted on Google Code, and it popped up <a class="reference external" href="https://github.com/giampaolo/psutil/issues?utf8=%E2%9C%93&amp;q=getloadavg">multiple times</a> throughout the years. There was/is a bunch of info on internet mentioning the bits with which it's theoretically possible to do this (the so called <cite>System Processor Queue Length</cite>), but I couldn't find any real implementation. A <a class="reference external" href="https://www.google.com/search?client=ubuntu&amp;hs=2EI&amp;channel=fs&amp;ei=LafCXO2ZE8PKswX9kY-wAw&amp;q=windows+load+average&amp;oq=windows+load+average&amp;gs_l=psy-ab.3..0j0i22i30l7.12536.13873..14008...0.0..0.482.2591.4-6......0....1..gws-wiz.......0i71j0i131.37ys3SB25pE">Google search</a> tells there is quite some demand for this, but very few tools out there providing this natively (the only one I could find is this <a class="reference external" href="https://blog.sflow.com/2011/02/windows-load-average.html">sFlowTrend</a> tool and <a class="reference external" href="https://www.zabbix.com/forum/zabbix-help/50423-windows-cpu-load">Zabbix</a>), so I'm very happy this finally landed into psutil / Python.</p>
<div class="section" id="other-improvements-and-bugfixes-in-psutil-5-6-2">
<h2>Other improvements and bugfixes in psutil 5.6.2<a class="headerlink" href="#other-improvements-and-bugfixes-in-psutil-5-6-2" title="Permalink to this headline">¶</a></h2>
<p>The full list is <a class="reference external" href="https://github.com/giampaolo/psutil/blob/master/HISTORY.rst#562">here</a> but I would like to mention a couple:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/giampaolo/psutil/issues/1476">1476</a>: the possibility to set process' high I/O priority on Windows</li>
<li><a class="reference external" href="https://github.com/giampaolo/psutil/issues/1476">1458</a>: colorized test output. I admit nobody will use this directly but it's very cool and I'm porting it to a bunch of other projects I work on (e.g. pyftpdlib). Also, perhaps this could be a good candidate for a small module to put on PYPI which can also include some functionalities taken from pytest and which I'm gradually re-implementing in unittest module amongst which:<ul>
<li><a class="reference external" href="https://github.com/giampaolo/psutil/issues/1478">1478</a>: re-running failed tests</li>
<li>display test timings/durations: this is something I'm contributing to cPython, see <a class="reference external" href="https://bugs.python.org/issue4080">BPO-4080</a> and and <a class="reference external" href="https://github.com/python/cpython/pull/12271/files">PR-12271</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="about-me">
<h2>About me<a class="headerlink" href="#about-me" title="Permalink to this headline">¶</a></h2>
<p>I'm currently in China (Shenzhen) for a mix of vacation and work, and I will likely take a break from Open Source for a while (likely 2.5 months, during which I will also go to Philippines and Japan - I love Asia ;-)).</p>
</div>
<div class="section" id="external">
<h2>External<a class="headerlink" href="#external" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.reddit.com/r/Python/comments/bhji0m/new_psutil_562_with_load_average_emulation_on/">Reddit</a></li>
</ul>
</div>

        </div>
    </article></li>
            </ol><!-- /#posts-list -->
  <nav>
    <ul>
      <li>Page 1 / 5</li>
        <li><a href="https://gmpy.dev/tags/python2.html">&rang;</a></li>
        <li><a href="https://gmpy.dev/tags/python5.html">&Rang;</a></li>
    </ul>
  </nav>
 <!-- /blog posts -->
</section>

    <!-- Footer -->
    <section id="extras" class="body">

        <div class="social">
            <h2>Social</h2>
            <ul>
                <li><a href="https://github.com/giampaolo">github</a></li>
                <li><a href="https://www.linkedin.com/in/grodola/">linkedin</a></li>
                <li><a href="https://twitter.com/grodola">twitter</a></li>
            </ul>
        </div><!-- /.social -->

        <div class="feeds">
            <h2>Feeds</h2>
            <ul>
                <li><a href="https://gmpy.dev/feeds/atom.all.xml" type="application/atom+xml" rel="alternate">atom</a></li>
                <li><a href="https://gmpy.dev/feeds/rss.all.xml" type="application/rss+xml" rel="alternate">rss</a></li>
            </ul>
        </div>
    </div>
    </section>
    <!-- /Footer -->

    <footer id="contentinfo" class="body">
        <!--
            <address id="about" class="vcard body">
            Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
            </address>

            <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        -->
    </footer>

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-164357405-2', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
    var disqus_shortname = 'gmpy-dev';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>